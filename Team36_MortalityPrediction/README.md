# ICU-Mortality-Prediction-Team36

## Dependencies:

pandas, keras, seaborn, tensorflow with tensorboard, pyyaml

## Data
A subset of the data can be found under the folder `sub-dataset`, which was generated by randomly selected 1% of the 
total lines with the following commands:
```shell
head -1 data/PATIENTS.csv > data_subset/PATIENTS.csv
perl -ne 'print if (rand() < .01)' data/PATIENTS.csv > data_subset/PATIENTS.csv
```

## Environment
We used the CSE6250 docker image `sunlab/bigbox:latest` to run the Apache Pig code that generates `data/Demographics.csv`.

## Cohort Selection
Run the `cohort/heart_disease_analysis.py` or `cohort/heart_disease_analysis.pig` to generate `Demographics.csv` file.

### Python3
Run the Python cohort selection code in your local machine with python3:

```shell
python3 cohort/heart_disease_analysis.py 
```

### PIG
Alternatively, you can start CSE6250 container from `sunlab/bigbox:latest` image by executing the `docker_env.sh` file:
```shell
$ ./docker_env.sh
$ docker exec -it $(docker ps -q) bash

[root@bootcamp ~]$ cd /mnt/host/ICU-Mortality-Prediction-Team36/cohort
[root@bootcamp cohort]$ sudo pig -x local heart_disease_analysis.pig
```


## Training

In order to train the models, configure the necessary parameters (presently set to experimental values) in the `config.yml` file and run:
```shell
python train.py
```

The classifier_type field in the config file can be one of {highway_maxout, embedding_plus_highway_maxout, multilayer_perceptron, embedding_plus_multilayer_perceptron}. If the set value is not one of these, a ValueError will be thrown

At the end of training, the accuracy and AUC scores on the held-out test set are reported

## Important Files and Model Outputs

The final input file for our Machine Learning algorithm is written to data/Demographics.csv (path can be changed in the config.yml)

Saved Model files can be found in saved_models/{classifer_type}

TF Summaries and model graph are written to logs/{classifier_type} and can be easily with tensorboard to validating the learning curves and easy visualization of the model graphs

For example to see the learning curve and model architecture for multilayer_perceptron run:

```
tensorboard --logdir='logs/multilayer_perceptron'
```

Please note that because of the small size of the train dataset results can be erratic and may vary widely between two different runs of training.

## Contributors (_sorted alphabetically_)

* **[Francisco Duran](https://github.gatech.edu/fgfjg3)**

    * Feature/cohort data extraction using big data tools

* **[Harsh Kohli](https://github.gatech.edu/hkohli3)**

    * Machine Learning/Highway Maxout Network modeling
  
* **[Jennifer S. Johnson](https://github.gatech.edu/gtg147t)**

    * Project integration and final deliverables

* **[Partha Sarathi Bera](https://github.gatech.edu/pbera3)**

    * Feature/cohort data extraction